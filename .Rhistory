##CHAPTER 4 - THE RELATION BETWEEN RUNS AND WINS
setwd("C:/Users/ethompson/Desktop/Lahman")
teams <- read.csv("data/teams.csv")
teams <- read.csv("/data/teams.csv")
teams <- read.csv("C:/Users/ethompson/Desktop/Lahman/data/teams/csv")
teams <- read.csv("C:/Users/ethompson/Desktop/Lahman/data/Teams.RData")
head(teams)
str(teams)
teams <- load("C:/Users/ethompson/Desktop/Lahman/data/Teams.RData")
str(teams)
str(Teams)
myteams <- subset(Teams, yearID > 2000)[ ,
c("teamID", "yearID", "lgID", "G", "W", "L", "R", "RA")]
myteams$RD <- with(myteams, R-RA)
myteams$Wpct <- with(myteams, W/(W+L))
plot(myteams$RD, myteams$Wpct, xlab="run differential", ylab="winning percentage")
linfit <- lm(Wpct ~ RD, data=myteams)
linfit
abline(a=coef(linfit)[1], b=coef(linfit)[2], lwd=2)
myteams$linWpct <- predict(linfit)
myteams$linResiduals <- residuals(linfit)
plot(myteams$RD, myteams$linResiduals,
xlab="run differential", ylab="residual")
abline(h=0, lty=3)
points(c(66,88), c(0.749, -0.0733), pch=19)
text(68, .0749, "LAA '08", pos=4, cex=.8)
text(88, -.0733, "CLE '06", pos=4, cex=.8)
mean(myteams$linResiduals)
linRMSE <- sqrt(mean(myteams$linResiduals ^2))
linRMSE
nrow(subset(myteams, abs(linResiduals) < linRMSE)) / nrow(myteams)
nrow(subset(myteams, abs(linResiduals) < 2*linRMSE)) / nrow(myteams)
myteams$pytWpct <- with(myteams, R^2/(R^2+RA^2))
myteams$pytResiduals <- myteams$Wpct - myteams$pytWpct
sqrt(mean(myteams$pytResiduals^2))
myteams$logWratio <- log(myteams$W / myteams$L)
myteams$logRratio <- log(myteams$R / myteams$RA)
pytFit <- lm(logWratio ~ 0 + logRratio, data=myteams)
setwd("C:/Users/ethompson/Desktop/Lahman")
gl2011 <- read.table("gl2011.txt", sep=",")
#EXERCISES - question 3 - Managers who outperformed Pythag
myteamsSince51 <- subset(Teams, yearID & yearID > 1950)[ , c("teamID",
"yearID", "lgID", "G", "W", "L", "R", "RA")]
myteamsSince51$logWratio <- log(myteamsSince51$W / myteamsSince51$L)
myteamsSince51$logRratio <- log(myteamsSince51$R / myteamsSince51$RA)
pytFitSince51 <- lm(logWratio ~ 0 + logRratio, data=myteamsSince51)
pytFitSince51
#so, since 1951, the Pythag coefficient is 1.856
myteamsSince51$pytWpct <- with(myteamsSince51, R^1.856 / (R^1.856 + RA^1.856))
myteamsSince51$Wpct <- with(myteamsSince51, W/(W+L))
myteamsSince51$pytResiduals <- with(myteamsSince51, Wpct - pytWpct)
#to finish this, need to load Manager data, probably merge it with myteamsSince51,
myteamsWestSince90 <- subset(teams,
yearID>=1990 &
(franchID=="SEA"|franchID=="ANA"|franchID=="TEX"|franchID=="OAK")
)[ , c("teamID", "franchID", "yearID", "lgID", "G", "W", "L", "R", "RA")]
myteamsWestSince90 <- subset(Teams,
yearID>=1990 &
(franchID=="SEA"|franchID=="ANA"|franchID=="TEX"|franchID=="OAK")
)[ , c("teamID", "franchID", "yearID", "lgID", "G", "W", "L", "R", "RA")]
myteamsWestSince90$logWratio <- log(myteamsWestSince90$W / myteamsWestSince90$L)
myteamsWestSince90$logRratio <- log(myteamsWestSince90$R / myteamsWestSince90$RA)
pytFitWestSince90 <- lm(logWratio ~ 0 + logRratio, data=myteamsWestSince90)
pytFitWestSince90
myteamsWestSince90$pytWpct <- with(myteamsWestSince90, R^1.934 / (R^1.934 + RA^1.934))
myteamsWestSince90$Wpct <- with(myteamsWestSince90, W/(W+L))
myteamsWestSince90$pytResiduals <- with(myteamsWestSince90, Wpct - pytWpct)
windows(width=8, height=11)
plot(myteamsWestSince90$pytWpct, myteamsWestSince90$Wpct,
xlab="Pythagorean Win %",
ylab="Actual Win %")
curve(0 + x, add=TRUE)
curve(.040 + x, add=TRUE)
curve(-.040 + x, add=TRUE)
text(.63, .71, "Overachievers")
text(.65, .65, "Met Expectation")
text(.65, .58, "Underachievers")
text(.462, .525, "SEA 2009", pos=2, cex=.8)
text(.489, .543, "SEA 2007", pos=2, cex=.8)
text(.528, .574, "OAK 2006", pos=2, cex=.8)
text(.550, .593, "OAK 1992", pos=2, cex=.8)
text(.545, .617, "ANA 2008", pos=2, cex=.8)
identify(myteamsWestSince90$pytWpct, myteamsWestSince90$Wpct,
labels=myteamsWestSince90$franchID, n=5)
##CHAPTER 4 - THE RELATION BETWEEN RUNS AND WINS
setwd("C:/Users/ethompson/Desktop/baseball")
load("C:/Users/ethompson/Desktop/baseball/core/Teams.RData")
Teams <- read.csv("C:/Users/ethompson/Desktop/baseball/core/Teams.csv")
str(Teams)
myteams <- subset(Teams, yearID > 2000)[ ,
c("teamID", "yearID", "lgID", "G", "W", "L", "R", "RA")]
myteams$RD <- with(myteams, R-RA)
myteams$Wpct <- with(myteams, W/(W+L))
plot(myteams$RD, myteams$Wpct, xlab="run differential", ylab="winning percentage")
linfit <- lm(Wpct ~ RD, data=myteams)
linfit
abline(a=coef(linfit)[1], b=coef(linfit)[2], lwd=2)
myteams$linWpct <- predict(linfit)
myteams$linResiduals <- residuals(linfit)
plot(myteams$RD, myteams$linResiduals,
xlab="run differential", ylab="residual")
abline(h=0, lty=3)
points(c(66,88), c(0.749, -0.0733), pch=19)
text(68, .0749, "LAA '08", pos=4, cex=.8)
text(88, -.0733, "CLE '06", pos=4, cex=.8)
mean(myteams$linResiduals)
linRMSE <- sqrt(mean(myteams$linResiduals ^2))
linRMSE
nrow(subset(myteams, abs(linResiduals) < linRMSE)) / nrow(myteams)
nrow(subset(myteams, abs(linResiduals) < 2*linRMSE)) / nrow(myteams)
myteams$pytWpct <- with(myteams, R^2/(R^2+RA^2))
myteams$pytResiduals <- myteams$Wpct - myteams$pytWpct
sqrt(mean(myteams$pytResiduals^2))
myteams$logWratio <- log(myteams$W / myteams$L)
myteams$logRratio <- log(myteams$R / myteams$RA)
pytFit <- lm(logWratio ~ 0 + logRratio, data=myteams)
#EXERCISES - question 3 - Managers who outperformed Pythag
myteamsSince51 <- subset(Teams, yearID & yearID > 1950)[ , c("teamID",
"yearID", "lgID", "G", "W", "L", "R", "RA")]
myteamsSince51$logWratio <- log(myteamsSince51$W / myteamsSince51$L)
myteamsSince51$logRratio <- log(myteamsSince51$R / myteamsSince51$RA)
pytFitSince51 <- lm(logWratio ~ 0 + logRratio, data=myteamsSince51)
pytFitSince51
#so, since 1951, the Pythag coefficient is 1.856
myteamsSince51$pytWpct <- with(myteamsSince51, R^1.856 / (R^1.856 + RA^1.856))
myteamsSince51$Wpct <- with(myteamsSince51, W/(W+L))
myteamsSince51$pytResiduals <- with(myteamsSince51, Wpct - pytWpct)
#to finish this, need to load Manager data, probably merge it with myteamsSince51,
#and then find which Managers exceeded and underperformed versus Pythag expctation
#What if we just analyzed it by teamID instred of manager?
#I will look at four AL West teams, since 1990
myteamsWestSince90 <- subset(Teams,
yearID>=1990 &
(franchID=="SEA"|franchID=="ANA"|franchID=="TEX"|franchID=="OAK")
)[ , c("teamID", "franchID", "yearID", "lgID", "G", "W", "L", "R", "RA")]
myteamsWestSince90$logWratio <- log(myteamsWestSince90$W / myteamsWestSince90$L)
myteamsWestSince90$logRratio <- log(myteamsWestSince90$R / myteamsWestSince90$RA)
pytFitWestSince90 <- lm(logWratio ~ 0 + logRratio, data=myteamsWestSince90)
pytFitWestSince90
#so the Pythag coeff is 1.934 for current AL West teams, since 1990
myteamsWestSince90$pytWpct <- with(myteamsWestSince90, R^1.934 / (R^1.934 + RA^1.934))
myteamsWestSince90$Wpct <- with(myteamsWestSince90, W/(W+L))
myteamsWestSince90$pytResiduals <- with(myteamsWestSince90, Wpct - pytWpct)
windows(width=8, height=11)
plot(myteamsWestSince90$pytWpct, myteamsWestSince90$Wpct,
xlab="Pythagorean Win %",
ylab="Actual Win %")
curve(0 + x, add=TRUE)
curve(.040 + x, add=TRUE)
curve(-.040 + x, add=TRUE)
text(.63, .71, "Overachievers")
text(.65, .65, "Met Expectation")
text(.65, .58, "Underachievers")
text(.462, .525, "SEA 2009", pos=2, cex=.8)
text(.489, .543, "SEA 2007", pos=2, cex=.8)
text(.528, .574, "OAK 2006", pos=2, cex=.8)
text(.550, .593, "OAK 1992", pos=2, cex=.8)
text(.545, .617, "ANA 2008", pos=2, cex=.8)
##CHAPTER 4 - THE RELATION BETWEEN RUNS AND WINS
setwd("C:/Users/ethompson/Desktop/baseball")
Teams <- read.csv("C:/Users/ethompson/Desktop/baseball/core/Teams.csv")
myteams <- subset(Teams, yearID > 2000)[ ,
c("teamID", "yearID", "lgID", "G", "W", "L", "R", "RA")]
myteams$RD <- with(myteams, R-RA)
myteams$Wpct <- with(myteams, W/(W+L))
plot(myteams$RD, myteams$Wpct, xlab="run differential", ylab="winning percentage")
linfit <- lm(Wpct ~ RD, data=myteams)
linfit
abline(a=coef(linfit)[1], b=coef(linfit)[2], lwd=2)
myteams$linWpct <- predict(linfit)
myteams$linResiduals <- residuals(linfit)
plot(myteams$RD, myteams$linResiduals,
xlab="run differential", ylab="residual")
abline(h=0, lty=3)
points(c(66,88), c(0.749, -0.0733), pch=19)
text(68, .0749, "LAA '08", pos=4, cex=.8)
text(88, -.0733, "CLE '06", pos=4, cex=.8)
mean(myteams$linResiduals)
linRMSE <- sqrt(mean(myteams$linResiduals ^2))
linRMSE
nrow(subset(myteams, abs(linResiduals) < linRMSE)) / nrow(myteams)
nrow(subset(myteams, abs(linResiduals) < 2*linRMSE)) / nrow(myteams)
myteams$pytWpct <- with(myteams, R^2/(R^2+RA^2))
myteams$pytResiduals <- myteams$Wpct - myteams$pytWpct
sqrt(mean(myteams$pytResiduals^2))
myteams$logWratio <- log(myteams$W / myteams$L)
myteams$logRratio <- log(myteams$R / myteams$RA)
pytFit <- lm(logWratio ~ 0 + logRratio, data=myteams)
#EXERCISES - question 3 - Managers who outperformed Pythag
myteamsSince51 <- subset(Teams, yearID & yearID > 1950)[ , c("teamID",
"yearID", "lgID", "G", "W", "L", "R", "RA")]
myteamsSince51$logWratio <- log(myteamsSince51$W / myteamsSince51$L)
myteamsSince51$logRratio <- log(myteamsSince51$R / myteamsSince51$RA)
pytFitSince51 <- lm(logWratio ~ 0 + logRratio, data=myteamsSince51)
pytFitSince51
#so, since 1951, the Pythag coefficient is 1.856
myteamsSince51$pytWpct <- with(myteamsSince51, R^1.856 / (R^1.856 + RA^1.856))
myteamsSince51$Wpct <- with(myteamsSince51, W/(W+L))
myteamsSince51$pytResiduals <- with(myteamsSince51, Wpct - pytWpct)
#to finish this, need to load Manager data, probably merge it with myteamsSince51,
#and then find which Managers exceeded and underperformed versus Pythag expctation
#What if we just analyzed it by teamID instred of manager?
#I will look at four AL West teams, since 1990
myteamsWestSince90 <- subset(Teams,
yearID>=1990 &
(franchID=="SEA"|franchID=="ANA"|franchID=="TEX"|franchID=="OAK")
)[ , c("teamID", "franchID", "yearID", "lgID", "G", "W", "L", "R", "RA")]
myteamsWestSince90$logWratio <- log(myteamsWestSince90$W / myteamsWestSince90$L)
myteamsWestSince90$logRratio <- log(myteamsWestSince90$R / myteamsWestSince90$RA)
pytFitWestSince90 <- lm(logWratio ~ 0 + logRratio, data=myteamsWestSince90)
pytFitWestSince90
#so the Pythag coeff is 1.934 for current AL West teams, since 1990
myteamsWestSince90$pytWpct <- with(myteamsWestSince90, R^1.934 / (R^1.934 + RA^1.934))
myteamsWestSince90$Wpct <- with(myteamsWestSince90, W/(W+L))
myteamsWestSince90$pytResiduals <- with(myteamsWestSince90, Wpct - pytWpct)
windows(width=8, height=11)
plot(myteamsWestSince90$pytWpct, myteamsWestSince90$Wpct,
xlab="Pythagorean Win %",
ylab="Actual Win %")
curve(0 + x, add=TRUE)
curve(.040 + x, add=TRUE)
curve(-.040 + x, add=TRUE)
text(.63, .71, "Overachievers")
text(.65, .65, "Met Expectation")
text(.65, .58, "Underachievers")
text(.462, .525, "SEA 2009", pos=2, cex=.8)
text(.489, .543, "SEA 2007", pos=2, cex=.8)
text(.528, .574, "OAK 2006", pos=2, cex=.8)
text(.550, .593, "OAK 1992", pos=2, cex=.8)
text(.545, .617, "ANA 2008", pos=2, cex=.8)
